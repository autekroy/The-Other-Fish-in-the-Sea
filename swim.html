<!DOCTYPE html>
<html>

<script id="vertex-shader" type="x-shader/x-vertex">

attribute vec4 vPosition;
attribute vec4 vNormal;
varying vec3 N, L, E;
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform vec4 lightPosition;

void main()
{
    vec3 pos = -(modelViewMatrix * vPosition).xyz;
    vec3 light = lightPosition.xyz;
    L = normalize( light - pos );
    E =  -pos;
    N = normalize( (modelViewMatrix*vNormal).xyz);
    gl_Position = projectionMatrix * modelViewMatrix * vPosition;
    
}
</script>

<script id="fragment-shader" type="x-shader/x-fragment">

precision mediump float;

uniform vec4 ambientProduct;
uniform vec4 diffuseProduct;
uniform vec4 specularProduct;
uniform float shininess;
varying vec3 N, L, E;

void main()
{    
    vec4 fColor;
    
    vec3 H = normalize( L + E );
    vec4 ambient = ambientProduct;

    float Kd = max( dot(L, N), 0.0 );
    vec4  diffuse = Kd*diffuseProduct;

    float Ks = pow( max(dot(N, H), 0.0), shininess );
    vec4  specular = Ks * specularProduct;
    
    if( dot(L, N) < 0.0 ) specular = vec4(0.0, 0.0, 0.0, 1.0);

    fColor = ambient + diffuse +specular;
    fColor.a = 1.0;

    gl_FragColor = fColor;
}
</script>

<script type="text/javascript" src="./Common/webgl-utils.js"></script>
<script type="text/javascript" src="./Common/initShaders.js"></script>
<script type="text/javascript" src="./Common/MV.js"></script>
<script type="text/javascript" src="render.js"></script>
<script>
window.onkeydown = function(event) {
    //var key = String.fromCharCode(event.keyCode);
    var key = window.event.keyCode;
    //alert(key);
    switch(key) {
        case 38: //up arrow
            altitude -= unit;
            break;
        case 40: //down arrow
            altitude += unit;
            break;

        case 37: //left arrow
            theta -= unit;
            break;
        case 39: //right arrow
            theta += unit;
            break;
        case 82: //'R': reset the view to start position
            phi = 0;
            theta = 0;
            radius = 25;    //reset the radius. Remove forward and backward effect.
            forwardUnit = 0;
            leftRight = 0;
            altitude = 0;
            break;
        case 67: // 'C': for change color
            colorChange = (colorChange + 1) % 8; //indicate which color the cube will start
            break;

        case 73: // 'I': for forward
            forwardUnit += unit;
            break;
        case 77: // 'M': for backward
            forwardUnit -= unit;
            break;
        case 74: // 'J': for left
            leftRight += unit;
            break;
        case 75: // 'K': for right
            leftRight -= unit;
            break;

        case 78: // 'N': for narrower
            fovy -= 1;
            break;
        case 87: // 'W': for wider
            fovy += 1;
            break;
        case 84: //'T': targe for cross-hair on the center of screen
            if(displayCrossHair)    displayCrossHair = false;
            else                    displayCrossHair = true;
            break;
    }
};
</script>

<body>
<canvas id="gl-canvas" width="700" height="700">
Oops ... your browser doesn't support the HTML5 canvas element
</canvas>
<pre>
Use four arrows keys to control the heading of camera.
</pre>
</body>
</html>
